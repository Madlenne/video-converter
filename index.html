<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codecs comparator</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
    />
  </head>

  <body>
    <div class="container">
      <br /><br />
      <h1 style="text-align: center;">Codecs comparator</h1>
      <form action="/convert" method="post" enctype="multipart/form-data">
        <!-- <form enctype="multipart/form-data"> -->
        <div class="form-group">
          <input type="file" name="file" id="file" />
        </div>
        <div class="form-group">
          <label for="to">To:</label>
          <select class="form-control" name="to" id="to">
            <option>mp4</option>
            <option>flv</option>
            <option>avi</option>
            <option>webm</option>
            <option>mov</option>
          </select>
        </div>
        <div class="form-group">
          <label for="to">With codec:</label>
          <select class="form-control" name="with" id="with">
            <option>mpeg4</option>
            <option>libx264</option>
            <option>vp9</option>
            <option>vp8</option>
            <option>vp7</option>
          </select>
        </div>
        <br />
        <div class="form-group">
          <!-- <button class="btn btn-primary btn-block" onclick="myFunction(event)"> -->
            <button class="btn btn-primary btn-block" >
            Upload
          </button>
          <button class="btn btn-primary btn-block" onclick="myFunction(event)">
            Convert
          </button>
          <div id="messages">

          </div>

          <div id="messages2">

        </div>
        </div>
      </form>
    </div>
    <script src="/socket.io/socket.io.js"></script>
    <script>

      async function myFunction(event) {
        event.preventDefault();
        document.getElementById("messages").innerHTML = "Hello World";
        // var file = document.getElementById("file").files[0].name;
        var to = document.getElementById("to").value;
        var withCodec = document.getElementById("with").value;

        var data = new FormData()
        data.append('file', document.getElementById("file").files[0]);

        console.log('aaaa', to, withCodec);
        // fetch("/test")
        // .then(res => {
        //     console.log(res);
        // })

        await fetch("/test", {
          method: "post",
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          //make sure to serialize your JSON body
          body: JSON.stringify({
            // file: file,
            to: to,
            with: withCodec
          })
        })
        .then((response) => response.text())
        .then(response => {
            console.log('aaa ', response);
        })
        
      }
      
      var socket = io();
      socket.on('progress', function(msg) {
        console.log("MSG!!!! ", msg);

        var messages = document.getElementById('messages')
        var item = document.createElement('li');
          item.textContent = msg.progress;
          messages.appendChild(item);
      });

      socket.on('progress2', function(msg) {
        console.log("MSG2!!!! ", msg);

        var messages = document.getElementById('messages2')
        var item = document.createElement('li');
          item.textContent = msg.progress;
          messages.appendChild(item);
      });

    </script>
  </body>
</html>